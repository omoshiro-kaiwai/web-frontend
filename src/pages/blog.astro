---
import Layout from '../layouts/Layout.astro';
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

const FALLBACK_IMAGE = '/images/fallback.png';

// './blog/*.md' の部分をプロジェクトの構成に合わせて適宜変更してください
const allPosts = await Astro.glob('./blog/*.md');
// 日付の降順（新しい順）に記事をソート
const sortedPosts = allPosts.sort((a, b) => new Date(b.frontmatter.date).valueOf() - new Date(a.frontmatter.date).valueOf());

// 日付を YYYY.MM.DD 形式にフォーマットするヘルパー関数
export function formatDate(dateString: string) {
    const date = new Date(dateString);
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}.${month}.${day}`;
}
---

<Layout title="投稿一覧 | おもしろ界隈">
    <Header />

    <main class="container">
        <h2 class="section-title">投稿一覧</h2>

        {/* 記事一覧をグリッドで表示 */}
        <div class="recent-posts-grid">
            {sortedPosts.map(post => (
                <article class="post-card">
                    <a href={post.url}>
                        <img src={post.frontmatter.thumb || FALLBACK_IMAGE} alt={post.frontmatter.title} class="post-card-thumb" />
                        <div class="post-card-content">
                            <h4 class="post-card-title">{post.frontmatter.title}</h4>
                            <p class="post-card-summary">{post.frontmatter.summary}</p>
                            <div class="post-card-footer">
                                <div class="author-info">
                                    <img src={`/images/user${post.frontmatter.authorID}.jpg`} alt={post.frontmatter.author} class="author-icon" />
                                    <span class="author-name">{post.frontmatter.author}</span>
                                </div>
                                <time datetime={post.frontmatter.date} class="post-date">
                                    {formatDate(post.frontmatter.date)}
                                </time>
                            </div>
                        </div>
                    </a>
                </article>
            ))}
        </div>
    </main>

    <Footer />
</Layout>